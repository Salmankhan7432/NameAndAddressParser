<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Address Parser and Map Creation Form</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/singleLineTab.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/batchParserTab.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mapCreationFormTab.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/userDefinedComponentsTab.css') }}">
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            padding-bottom: 80px;
        }

        footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            background-image: url(../static/image.png);
            background-size: 110%;
            color: white;
            text-align: center;
            height: 75px;
        }

        footer h3 {
            margin-bottom: 10px;
            /* Reduced bottom margin */
            line-height: 1.2;
            /* Adjust this value as needed */
        }

        footer b {
            margin-top: 10px;
            /* Reduced top margin */
            display: block;
            /* Makes <b> behave like a block element */
        }
    </style>
</head>

<body>

    <div class="navbar" style="display: flex;">
        <img style="width: 10%; filter: invert(100%);" src="../static/logo.svg" alt="" class="logo">
        <div style="text-align: left; padding-bottom: 10px;" class="tabdiv">
            <a href="#" class="tablink" onclick="openTab('SingleLine',event)" id="defaultOpen">Single Line</a>
        </div>
        <div style="text-align: left;" class="tabdiv active">
            <a href="#" class="tablink" onclick="openTab('Batch',event)">Batch Parser</a>
        </div>
        {% if session.role == 'admin' or session.role == 'Committee_Member'%}
        <div style="text-align: left;" class="tabdiv">
            <a href="#" class="tablink" onclick="openTab('MapCreationForm',event)">Map Creation Form</a>
        </div>
        {% endif %}
         {% if session.role == 'admin'%}
        <div style="text-align: left;" class="tabdiv">
            <a href="#" class="tablink" id="userdfc" onclick="openTab('UDComponents',event)">User Defined Component</a>
        </div>
        {% endif %}
        
        
        {% if session.role == 'admin'%}
       <div style="text-align: left;" class="tabdiv">
           <a href="#" class="tablink" id="user" onclick="openTab('CreateUser',event)">CRUD users</a>
       </div>
         {% endif %}
 
 
   <div style="text-align: right;" class="tabdiv">
<form action="\logout" method="POST"> 
<button type="submit" name="logout">Logout</button>
</form>          </div>


    </div>


    <!-- Content for SingleLine Address Parser -->
    <div id="SingleLine" class="tabcontent singleLineTab-container">

        <div class="container">
            <form id="myForm" action="/" method="POST">
                <!--<div class="input-group"><label for="file-upload">Please Choose a Pipe Delimited File</label><input type="file" id="file-upload" name="file-upload"></div>-->
                <div class="input-group" style="display: inline-flex;">
                    <label for="address-input">Enter Address</label>
                    <input type="text" id="address-input" name="address" placeholder="1234 Main St"
                        autocomplete="address">
                    <button type="submit" id="submit-btn">Submit</button>
                </div>
                <center>
                    <div id="exception-controls" style="display:none;">
                        <label for="exception-checkbox">
                            <input type="checkbox" id="exception-checkbox" name="ForceException"
                                style="margin-left: 300px;"> Not Satisfied?
                        </label>
                        <button type="button" id="exception-btn" disabled>Force Exception</button>
                    </div>
                    <div id="parsed-by-info" style="margin-top: 10px; margin-bottom: 10px;">
                        <!-- "Address Parsed By -> " info will be inserted here -->
                    </div>
                    <div id="Mask_Pattern" style="margin-top: 10px; margin-bottom: 10px;">
                        <!-- "Mask Pattern -> " info will be inserted here -->
                    </div>
                </center>
        </div>
        <center>
            <div class="result-box" id="result-box">
                <div id="parsedbyar"></div>
                <table id="resultTable" class="table" style="display: none;">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Token</th>
                            <th scope="col">Address</th>
                            <th scope="col">Component</th>
                            <th scope="col">Component Description</th>
                        </tr>
                    </thead>
                    <tbody id="resultBody">
                        <!-- Table rows will be populated dynamically here -->
                    </tbody>
                </table>
            </div>
        </center>

        </form>
    </div>
        <!--------------------------------------------Batch Parser--------------------------------------->
    <div id="Batch" class="tabcontent batchParserTab-container" style="display: block;">
        <!-- Upload Section -->
        <div class="container">
            <center><h3 style="font-size: 18px; color: #2e4c8c;">Note: Please Upload Pipe Delimited File
            </h3></center>
            <center>
                <form id="BatchForm" method="post" action="{{ url_for('BatchParser') }}" enctype="multipart/form-data">
                    {{ form.hidden_tag() }}
                    <div class="input-group">
                    {{ form.file.label }} {{ form.file(class="custom-file-input", id="file-upload") }}
                    {{ form.submit(class="btn btn-primary", id="upload-btn") }}
                    </div>
                </form>
            </center>
            <!-- <progress id="progressBar" value="0" max="100" style="width: 100%;"></progress> -->

        </div>
        <!-- Metrics Display -->
        <div id="metrics-display" style="display:none; padding: 10px; margin-left: 400px;">
            <h2>Batch Parsing Metrics</h2>
            <p id="detailed-report"></p>
            <!-- Metrics will be inserted here -->
        </div>
    </div>
    <!--------------------------------------------------------------------------------------------------- -->
    <!-- Map Creattion Form -->
    <!--------------------------------------------------------------------------------------------------- -->
    <div id="MapCreationForm" class="tabcontent mapCreationFormTab-container">
        <center>
            <h3 style="font-size: 18px; color: #2e4c8c;">Note : Upload Exception File(JSON)</h3>
        </center>
        <div class="map-container container" id="upload">

            <input type="file" id="jsonFileInput" accept=".json">
            <button id="loadFileBtn">Load JSON File</button>
        </div>
        <div class="map-container" id="mapdata" style="grid-template-columns: 1fr 1fr;" hidden>
            <div class="leftContainer" style="width: 90%; height: 100vh; padding: 20px;">
                <div class="map-result-box" id="map-result-box">
                    <table id="data-table">
                        <thead>
                            <tr>
                                <th>Mask Token</th>
                                <th>Address Token</th>
                                <th>Address Component</th>
                            </tr>
                        </thead>
                        <tbody id="table-body">
                            <!-- Table body will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <head>
                <style>
                    .containerin {
                        display: flex;
                    }

                    .containerin label {
                        width: 200px;
                    }

                    .containerin select,
                    .containerin textarea {
                        margin-top: 5px;
                        width: 200%;
                    }

                    .containerin select input textarea {
                        width: 100%;
                    }
                </style>
            </head>
            <div class="rightContainer" id="inputData" style="width: 90%; height: 100vh; padding: 20px;">
                <div id="dictionaryInfo">
                    Current Dictionary: <span id="currentDictionaryDisplay">0/0</span>
                </div>

                <div class="containerin">
                    <label for="fileName">Exception
                        File Name :
                    </label>
                    <input type="text" id="filename" class="field" readonly>
                </div>

                <div class="containerin">
                    <label for="recordId">Record ID:</label>
                    <input type="text" id="recordId" readonly>
                </div>
                <div class="containerin">
                    <label for="inputValue">INPUT:</label>
                    <input type="text" id="inputValue" readonly>
                </div>
                <div class="containerin">
                    <label for="mask-inputValue">Mask Pattern:</label>
                    <input type="text" id="mask-inputValue" readonly>
                </div>
                <div class="containerin">
                    <label for="region" class="col-sm-2 col-form-label">Region:</label>
                    <select id="region" name="region" class="" required>
                        <option value="" selected disabled hidden></option>
                        <option value="US">US</option>
                        <option value="Puerto Rico">Puerto Rico</option>
                    </select>
                </div>
                <div class="containerin">
                    <label for="type">Address Type : </label>
                    <select id="AddressType" name="AddressType" class="" required>
                        <option value="" selected disabled hidden></option>
                        <option value="street address">Street Address</option>
                        <option value="po box address">PO Box Address</option>
                        <option value="highay contract address">Highway Contract Address</option>
                        <option value="militay address">Military Address</option>
                        <option value="attention line address">Attention Line Address</option>
                        <option value="roural route address">Roural Route Address</option>
                        <option value="puerto rico address">Puerto Rico Address</option>
                        <option value="university address">University Address</option>
                    </select>
                </div>
                <div class="containerin">
                    <!-- <label id="keyLabel" style="display:none; padding-bottom: 5px;"></label> -->
                    <label for="">Add to V-DB and KB : </label>
                    <select name="kb" id="Approved?" required>
                        <option value="" selected disabled hidden></option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="containerin">
                    <label for="comment">Comment : </label>
                    <textarea name="" id="comment" cols="30" rows="3"></textarea>
                </div>
                <div class="containerin">
                    <label for="approvedby">Approved By : </label>
                    <select name="approvedby" id="approvedby" required>
                        <option value="" selected disabled hidden></option>
                        <option value="Committee Member 1">Committee Member 1</option>
                        <option value="Committee Member 2">Committee Member 2</option>
                        <option value="Committee Member 3">Committee Member 3</option>
                    </select>
                </div>
                <div class="Button-container">
                    <button class="btn btn-success" id="submit&NextBtn">Submit & Next</button>
                    <button class="btn btn-success" id="submitBtn" style="display: none;">Submit</button>
                    <button class="btn btn-light" id="clear&exitBtn">Clear & Exit</button>
                </div>
            </div>
        </div>
    </div>
    <!--------------------------------------------------------------------------------------------------- -->
    <!--                            User Defined COmponents                                               -->
    <!--------------------------------------------------------------------------------------------------- -->

    <div id="UDComponents" class="tabcontent userDefinedComponentsTab-container">
        <div class="container">
            <!-- <form id="udForm" action="/UserDefinedComponents" method="GET"> -->
            <div class="udresult-box" id="udresult-box">
                <table id="udresultTable" class="table">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Component</th>
                            <th scope="col">Component Description</th>
                            <th scope="col" class="actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="udresultBody">
                        <!-- Table rows will be populated dynamically here -->
                    </tbody>
                </table>
            </div>
            <div class="buttons">

                <button onclick="fetchComponentData()" id="fetchall">Fetch All the Components</button>
                <button onclick="addComponent()">Add</button>
            </div>
            <!-- </form> -->
        </div>
    </div>

    <!-- User Creation Edit Delete -->
    
    <div id="CreateUser" class="tabcontent CRUDUser-container">
        <div class="container">
            <!-- <form id="udForm" action="/UserDefinedComponents" method="GET"> -->
{% if session.role == 'admin' %}
    <div class="user-management">
        <h2>User Management</h2>
        
        <!-- User Creation Form -->
        <div class="user-creation">
            <h3>Create New User</h3>
            <form action="/create_user" method="post">
                <input type="text" name="new_username" placeholder="Username" required>
                <input type="password" name="new_password" placeholder="Password" required>
                <select name="new_role" required>
                    <option value="user">User</option>
                    <option value="superuser">Superuser</option>
                    <option value="admin">Admin</option>
                </select>
                <input type="submit" value="Create User">
            </form>
        </div>
        
        <!-- User List and Edit/Delete Forms -->
        <table>
            <tr>
                <th>Username</th>
                <th>Role</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
            {% for user in users %}
            <tr>
                <form action="/edit_user/{{ user.id }}" method="post">
                    <td>{{ user.UserName }}</td>
                    <td>
                        <select name="role" required>
                            <option value="admin" {% if user.role.RoleName == 'admin' %}selected{% endif %}>Admin</option>
                            <option value="Committee_Member" {% if user.role.RoleName == 'Committee_Member' %}selected{% endif %}>Committee Member</option>
                            <option value="general_user" {% if user.role.RoleName == 'general_user' %}selected{% endif %}>General User</option>
                        </select>
                    </td>
                    <td>
                        <input type="submit" value="Edit">
                    </td>
                </form>
                <td>
                    <form action="/delete_user/{{ user.id }}" method="post" onsubmit="return confirm('Are you sure?');">
                        <input type="submit" value="Delete">
                    </form>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
{% endif %}


        </div>
    </div>




    
    <!-- <script>
                function openTab(tabName, event) {
                    var i;
                    var tabContents = document.getElementsByClassName("tabcontent");
                    var tabLinks = document.getElementsByClassName("tablink");

                    for (i = 0; i < tabContents.length; i++) {
                        tabContents[i].style.display = "none"; // Hide all tab content
                    }

                    for (i = 0; i < tabLinks.length; i++) {
                        tabLinks[i].className = tabLinks[i].className.replace(" active", ""); // Remove "active" class from all tabs
                    }

                    document.getElementById(tabName).style.display = "block"; // Show the content of the clicked tab
                    event.currentTarget.className += " active"; // Add "active" class to the clicked tab
                }
                document.getElementById("defaultOpen").click();
            </script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
<footer>
    <h3>Address Parser- Measuring address data accuracy by analyzing and structuring its components.</h3>
    <b>We Believe in the Power of Quality Data to Impact Public Life</b>
</footer>

</html>